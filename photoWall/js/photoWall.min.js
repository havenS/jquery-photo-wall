var yiiWall={view:"open",albumID:"",element:"",container:Array(),photoArray:Array(),displayedPhotos:Array(),c_width:0,allowOverride:false,maxRowHeight:200,photoMargin:5,baseURL:"",formats:"",url:"",addToCart:"",unpublished:"",photoDisplay:function(a){formats=$.parseJSON(this.formats);var b='<div id="photoDisplay'+a+'" style="display:none;" class="photoDisplay clearfix"><div class="thumb"><img></div><div id="formats">';for(i in formats){b+="<h4>"+formats[i].size.display+"</h4><h4>"+formats[i].price.amount+" "+formats[i].price.currency+'</h4><form method="post" action="'+this.addToCart+'"><input id="photo_id" type="hidden" name="photo_id" value=""><input id="format_id" type="hidden" name="format_id" value="'+formats[i]._id.$id+'"><input id="quantity" type="text" name="quantity" value="1"><input type="submit" class="btn btn-primary" value="Add To Cart"></form>'}b+="</div></div>";return b},getNewIMGView:function(a,c,b){return"<img onclick=\"showPhoto('"+this.displayedPhotos[c][a].id+"',"+b+')" id="photo_'+this.displayedPhotos[c][a].id+'" class="photo_'+a+' photo" src="'+this.displayedPhotos[c][a].img_path+'" style="margin:'+this.photoMargin+'px;display: none" height="'+this.maxRowHeight+'"/>'},displayWall:function(j){this.c_width=this.container[j].width();var b=0,o=Array(),h=1,d=0,e=1;while(d<this.displayedPhotos[j].length){d++}for(var f in this.displayedPhotos[j]){if(h===1){this.container[j].prepend('<div id="photoRow'+j+e+'" class="pwr clearfix">')}if(this.displayedPhotos[j][f].visible==1){var n="none",a="block"}else{var n="block",a="none"}var m=this.getNewIMGView(f,j,e);$("#photoRow"+j+e).append(m);var g=$("#photo_"+this.displayedPhotos[j][f].id);b+=g.width();o.push(this.displayedPhotos[j][f].id);if(b>this.c_width||h===d){$("#photoRow"+j+e).removeAttr("style");var k=(this.c_width-(this.photoMargin*2*o.length))/b;var l=$("#photo_"+o[0]).height()*k;for(f in o){var c=$("#photo_"+o[f]).width();if(l>this.maxRowHeight&&!this.allowOverride){$("#photo_"+o[f]).attr("height",this.maxRowHeight);if(this.view=="closed"){$("#unpublished"+o[f]).css("height",this.maxRowHeight);$("#unpublished"+o[f]).css("width",c);$("#thumbnail"+o[f]).css("height",this.maxRowHeight);$("#thumbnail"+o[f]).css("width",c)}}else{$("#photo_"+o[f]).attr("height",l);$("#photo_"+o[f]).attr("width",c*k);if(this.view=="closed"){$("#unpublished"+o[f]).css("height",l);$("#unpublished"+o[f]).css("width",c*k);$("#thumbnail"+o[f]).css("height",l);$("#thumbnail"+o[f]).css("width",c*k)}}}if(this.view!="closed"){this.container[j].append(this.photoDisplay(e))}e++;if(h!=d){this.container[j].append('<div id="photoRow'+j+e+'" class="pwr clearfix">')}b=0;o=Array()}h++}$(".photoWall").hide();$(".photo").show();$(".photoWall").fadeIn()},prepareDisplayedPhotos:function(a){hiddenPhotos=this.container[a].find("img");dp=Array();hiddenPhotos.each(function(c,b){dp[c]={id:b.id,img_path:b.src,width:b.width,height:b.height,visible:($(b).hasClass("visible"))?"1":"0"};b.remove()});this.displayedPhotos[a]=dp;this.container[a].css({overflow:"inherit"});if(this.view!="closed"){this.displayWall(a)}},generatePhotos:function(e){console.log(this.photoArray);for(var b in this.photoArray){var d=this.photoArray[b];var f=d.id;var c=this.baseURL+d.img_path;var a=d.visible;img=$("<img/>")[0];img.src=c;img.id=f;img.style.opacity="0";img.style.position="fixed";this.container[e].append(img);$(img).addClass((a=="1")?"visible":"hidden")}},init:function(a){this.container[a]=$(this.element+a);this.generatePhotos(a);if(this.view!="closed"){this.formats=this.getFormats();$(window).load(function(){yw.prepareDisplayedPhotos(a)})}}};yw=yiiWall;